<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Procurement Document Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet"
        href="{{ url_for('static', filename='style.css') if url_for is defined else '../static/style.css' }}">
</head>

<body>
    <div class="container">
        <div class="header-section">
            <div class="example-document-section">
                <button type="button" id="exampleDocBtn" class="example-doc-button">üìÑ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</button>
            </div>
            <div class="title-section">
                <h1 class="page-title">‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡∏±‡∏î‡∏à‡πâ‡∏≤‡∏á</h1>
                <h3 class="sub-title">‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡∏±‡∏î‡∏à‡πâ‡∏≤‡∏á</h3>
            </div>
        </div>

        <form id="procurementForm" action="/generate" method="post">
            <!-- Hidden input for current date in Thai Buddhist Era format -->
            <!-- <input type="hidden" id="current_date" name="current_date"> -->

            <div class="form-sections">
                <!--section1-->
                <div class="form-section section-box">
                    <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏à‡∏±‡∏î‡∏´‡∏≤</h3>
                    <div class="responsible-person">
                        <label for="responsible_person">‡∏ú‡∏π‡πâ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏à‡∏±‡∏î‡∏´‡∏≤/‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£ <spanclass="required">*</span></label>
                        <input type="text" id="responsible_person" name="responsible_person" required>
                        <label for="responsible_committee_member1">‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                        <input type="text" id="responsible_committee_member1" name="responsible_committee_member1">
                        <label for="responsible_committee_member2">‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                        <input type="text" id="responsible_committee_member2" name="responsible_committee_member2">
                        <div class="requesting-for">
                            <label for="requesting_for">‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏û‡∏∑‡πà‡∏≠ <span class="required">*</span></label>
                            <input type="text" id="requesting_for" name="requesting_for" required>
                        </div>
                    </div>
                </div>

                <!--section2-->
                <div class="form-section section-box">
                    <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏±‡∏ö‡∏û‡∏±‡∏™‡∏î‡∏∏</h3>
                    <div class="inspector">
                        <label for="inspector">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏±‡∏ö‡∏û‡∏±‡∏™‡∏î‡∏∏/‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£ <span
                                class="required">*</span></label>
                        <input type="text" id="inspector" name="inspector" required>
                        <label for="inspector_committee_member1">‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                        <input type="text" id="inspector_committee_member1" name="inspector_committee_member1">
                        <label for="inspector_committee_member2">‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                        <input type="text" id="inspector_committee_member2" name="inspector_committee_member2">
                    </div>
                </div>

                <!--section3-->
                <div class="form-section section-box">
                    <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏™‡∏î‡∏∏</h3>
                    <div class="supply-list-container">
                        <table class="supply-list-table">
                            <thead>
                                <tr>
                                    <th rowspan="2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏™‡∏î‡∏∏/‡∏á‡∏≤‡∏ô‡∏à‡πâ‡∏≤‡∏á</th>
                                    <th rowspan="2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                                    <th rowspan="2">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                                    <th rowspan="2">‡∏£‡∏ß‡∏°</th>
                                    <th colspan="2">‡∏û‡∏±‡∏™‡∏î‡∏∏‡∏ú‡∏•‡∏¥‡∏ï‡∏ó‡∏µ‡πà</th>
                                </tr>
                                <tr>
                                    <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢</th>
                                    <th>‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="supply-item">
                                    <td><input type="text" name="supply_name[]" required></td>
                                    <td><input type="text" name="supply_amount[]" min="1" required></td>
                                    <td><input type="text" name="supply_price_unit[]" min="0" step="0.01" required>
                                    </td>
                                    <td><input type="text" name="sum_supply_price[]" readonly></td>
                                    <td class="radio-cell"><input type="radio" name="product_origin_1" value="domestic" checked>
                                    </td>
                                    <td class="radio-cell"><input type="radio" name="product_origin_1" value="foreign">
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <button type="button" id="addSupplyRow" class="add-button">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
                        <button type="button" id="deleteSupplyRow" class="delete-button" title="‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£">-
                            ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
                        <div class="total-section">
                            <div class="total-supply-amount">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</div>
                            <div class="total-supply-amount"><span id="totalItems">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                            <div class="total-label">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô:</div>
                            <div class="total-amount"><span id="grandTotal">0.00</span> ‡∏ö‡∏≤‡∏ó</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- <div class="form-footer">
                <div class="form-group">
                    <label for="document_format">Document Format</label>
                    <select id="document_format" name="document_format">
                        <option value="docx">DOCX</option>
                        <option value="pdf">PDF</option>
                    </select>
                </div>

                <button type="submit">Generate Document</button>
            </div> -->

            <div class="form-footer">
                <button type="submit" class="manual-button">‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
                <div>
                    <button type="button" id="previewBtn" class="preview-button">Generate PDF</button>
                    <button type="submit" class="generate-button">Generate Document</button>
                </div>
            </div>

        </form>
    </div>

    <script>
        // Function to convert Gregorian date to Thai Buddhist Era format
        function convertToThaiDate(date) {
            // Thai month names
            const thaiMonths = [
                '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô',
                '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'
            ];

            // Convert to Buddhist Era (BE = CE + 543)
            const day = date.getDate();
            const month = thaiMonths[date.getMonth()];
            const year = date.getFullYear() + 543; // Convert to Buddhist Era

            // Format: ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà DD ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô MMMM ‡∏û.‡∏®. YYYY
            return `‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${day} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ${month} ‡∏û.‡∏®. ${year}`;
        }

        // Set current date in Thai Buddhist Era format when page loads
        document.addEventListener('DOMContentLoaded', function () {
            const currentDate = new Date();
            const thaiDate = convertToThaiDate(currentDate);
            document.getElementById('current_date').value = thaiDate;

            // Display current date in the form (optional)
            const dateInfoDiv = document.createElement('div');
            dateInfoDiv.className = 'date-info';
            dateInfoDiv.innerHTML = `<span>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ${thaiDate}</span>`;

            // Insert after the title section
            const titleSection = document.querySelector('.title-section');
            titleSection.parentNode.insertBefore(dateInfoDiv, titleSection.nextSibling);
        });

        // Improved form validation for task 3.2
        document.getElementById('procurementForm').addEventListener('submit', function (event) {
            // Get all required inputs
            const requiredInputs = document.querySelectorAll('#procurementForm [required]');
            let isValid = true;
            let errorMessage = '';

            // Check each required field
            requiredInputs.forEach(function (input) {
                if (!input.value.trim()) {
                    isValid = false;
                    const label = input.previousElementSibling?.textContent || input.closest('td')?.previousElementSibling?.textContent || 'required field';
                    errorMessage += `‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å ${label.replace('*', '').trim()}\n`;
                    input.classList.add('error');
                } else {
                    input.classList.remove('error');
                }
            });

            // Prevent form submission if validation fails
            if (!isValid) {
                event.preventDefault();
                alert(errorMessage);
            }
        });

        // Real-time validation feedback
        document.querySelectorAll('#procurementForm [required]').forEach(function (input) {
            input.addEventListener('blur', function () {
                if (!this.value.trim()) {
                    this.classList.add('error');
                } else {
                    this.classList.remove('error');
                }
            });

            // Remove error class when user starts typing
            input.addEventListener('input', function () {
                if (this.value.trim()) {
                    this.classList.remove('error');
                }
            });
        });

        // Example document button functionality
        document.getElementById('exampleDocBtn').addEventListener('click', function () {
            // Open example document PDF in new tab
            window.open('/public/example-document.pdf', '_blank');
        });

        // Preview button functionality
        document.getElementById('previewBtn').addEventListener('click', function () {
            // Validate form before preview
            const requiredInputs = document.querySelectorAll('#procurementForm [required]');
            let isValid = true;

            requiredInputs.forEach(function (input) {
                if (!input.value.trim()) {
                    isValid = false;
                    input.classList.add('error');
                } else {
                    input.classList.remove('error');
                }
            });

            if (!isValid) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á');
                return;
            }

            // Create a temporary form for preview
            const form = document.getElementById('procurementForm');
            const originalAction = form.action;

            // Change action to preview endpoint
            form.action = '/preview';
            form.target = '_blank';

            // Submit form
            form.submit();

            // Restore original action
            form.action = originalAction;
            form.target = '';
        });
    </script>
    <script
        src="{{ url_for('static', filename='supply-list.js') if url_for is defined else '../static/supply-list.js' }}"></script>
</body>

</html>