<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Procurement Document Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="static/style.css">
</head>

<body>
    <div class="container">
        <!-- Hidden image for PDF generation -->
        <img id="img" src="static/img/krut.jpg" style="display: none;" alt="Logo" />
        <img id="msuimg" src="static/img/msuLogo.jpg" style="display: none;" alt="msuLogo" />

        <div class="header-section">
            <div class="title-section">
                <h1 class="page-title">เอกสารขออนุมัติจัดซื้อจัดจ้าง</h1>
                <h3 class="sub-title">ระบบสร้างเอกสารเพื่อใช้ในการขออนุมัติจัดซื้อจัดจ้าง</h3>
            </div>
            <div class="date-input-container">
                <div class="date-input">
                    <label for="thai-datepicker1">ณ วันที่</label>
                    <input id="thai-datepicker1" type="text" placeholder="ว/ด/ปี" title="เลือกวันที่"
                        autocomplete="off">
                </div>
            </div>
        </div>

        <form id="procurementForm">
            <!-- Hidden input for current date in Thai Buddhist Era format -->
            <!-- <input type="hidden" id="current_date" name="current_date"> -->

            <div class="form-sections">
                <!--section1-->
                <div class="form-section section-box">
                    <h3>ข้อมูลผู้ขอให้จัดหา</h3>
                    <div class="responsible-person">
                        <label for="responsible_person">ผู้ขอให้จัดหา/ประธานกรรมการ <span
                                class="required">*</span></label>
                        <input type="text" id="responsible_person" name="responsible_person" required>
                        <label for="responsible_committee_member1">กรรมการ (ถ้ามี)</label>
                        <input type="text" id="responsible_committee_member1" name="responsible_committee_member1">
                        <label for="responsible_committee_member2">กรรมการ (ถ้ามี)</label>
                        <input type="text" id="responsible_committee_member2" name="responsible_committee_member2">

                    </div>
                </div>

                <!--section1.5 - Objective and Purpose Section-->
                <div class="form-section section-box">
                    <h3>วัตถุประสงค์</h3>
                    <div class="objective-section">
                        <label for="objective">จะดำเนินการขอ <span class="required">*</span></label>
                        <div class="objective-list">
                            <div class="radio-option">
                                <input type="radio" id="radio1" name="objective" value="จัดซื้อ" required>
                                <label for="radio1">จัดซื้อ</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="radio2" name="objective" value="ขอจ้าง">
                                <label for="radio2">ขอจ้าง</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="radio3" name="objective" value="การเช่า">
                                <label for="radio3">การเช่า</label>
                            </div>
                        </div>
                        <input type="text" id="objective" name="objective">
                        <div class="requesting-for">
                            <label for="requesting_for">เพื่อใช้ <span class="required">*</span></label>
                            <input type="text" id="requesting_for" name="requesting_for" required>
                        </div>
                    </div>
                </div>

                <!--section2-->
                <div class="form-section section-box">
                    <h3>ข้อมูลผู้ตรวจรับพัสดุ</h3>
                    <div class="inspector">
                        <label for="inspector">รายชื่อผู้ตรวจรับพัสดุ/ประธานกรรมการ <span
                                class="required">*</span></label>
                        <input type="text" id="inspector" name="inspector" required>
                        <label for="inspector_committee_member1">กรรมการ (ถ้ามี)</label>
                        <input type="text" id="inspector_committee_member1" name="inspector_committee_member1">
                        <label for="inspector_committee_member2">กรรมการ (ถ้ามี)</label>
                        <input type="text" id="inspector_committee_member2" name="inspector_committee_member2">
                    </div>
                </div>

                <!--section3-->
                <div class="form-section section-box">
                    <h3>รายการวัสดุ</h3>
                    <div class="supply-list-container">
                        <table class="supply-list-table">
                            <thead>
                                <tr>
                                    <th rowspan="2">รายการวัสดุ/งานจ้าง</th>
                                    <th rowspan="2">จำนวน</th>
                                    <th rowspan="2">หน่วย</th>
                                    <th rowspan="2">ราคาต่อหน่วย</th>
                                    <th rowspan="2">รวม</th>
                                    <th colspan="2">พัสดุผลิตที่</th>
                                </tr>
                                <tr>
                                    <th>ประเทศไทย</th>
                                    <th>ต่างประเทศ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="supply-item">
                                    <td><input type="text" name="supply_name[]"></td>
                                    <td><input type="text" name="supply_amount[]" min="1"></td>
                                    <td><input type="text" name="supply_unit[]"></td>
                                    <td><input type="text" name="supply_price_unit[]" min="0" step="0.01">
                                    </td>
                                    <td><input type="text" name="sum_supply_price[]" readonly></td>
                                    <td class="radio-cell"><input type="radio" name="product_origin_1" value="domestic"
                                            checked>
                                    </td>
                                    <td class="radio-cell"><input type="radio" name="product_origin_1" value="foreign">
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <button type="button" id="addSupplyRow" class="add-button">+ เพิ่มรายการ</button>
                        <button type="button" id="deleteSupplyRow" class="delete-button" title="ลบรายการ">-
                            ลบรายการ</button>
                        <div class="vat-section">
                            <div class="vat-options">
                                <label>สถานะ VAT:</label>
                                <div class="vat-radio-group">
                                    <label class="vat-option">
                                        <input type="radio" name="vat_status" value="no_vat" checked>
                                        ไม่มี VAT
                                    </label>
                                    <label class="vat-option">
                                        <input type="radio" name="vat_status" value="vat_included">
                                        รวม VAT แล้ว
                                    </label>
                                    <label class="vat-option">
                                        <input type="radio" name="vat_status" value="vat_excluded">
                                        ยังไม่รวม VAT
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="total-section">
                            <div class="total-supply-amount">จำนวนรายการ:</div>
                            <div class="total-supply-amount"><span id="totalItems">0</span> รายการ</div>
                            <div class="vat-row" id="vatRow" style="display: none;">
                                <div class="vat-label">VAT 7%:</div>
                                <div class="vat-amount"><span id="vatAmount">0.00</span> บาท</div>
                            </div>
                            <div class="total-label">ราคารวมทั้งสิ้น:</div>
                            <div class="total-amount"><span id="grandTotal">0.00</span> บาท</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- <div class="form-footer">
                <div class="form-group">
                    <label for="document_format">Document Format</label>
                    <select id="document_format" name="document_format">
                        <option value="docx">DOCX</option>
                        <option value="pdf">PDF</option>
                    </select>
                </div>
                <button type="submit">Generate Document</button>
            </div> -->
            <!--section 5-->
            <div class="form-section section-box">
                <h3>แบบ บก.๐๖</h3>
                <div class="bg06">
                    <div class="form-group">
                        <label class="section-label">๔. วันที่กำหนดราคากลาง</label>
                        <div class="date-input-group">
                            <label for="thai-datepicker2" class="inline-label">(ราคาอ้างอิง) ณ วันที่</label>
                            <input id="thai-datepicker2" type="text" placeholder="ว/ด/ปี" title="เลือกวันที่"
                                autocomplete="off" class="date-input">
                        </div>
                        <div class="detail-input-group">
                            <label for="4-detail" class="inline-label">รายละเอียด</label>
                            <input type="text" name="4-detail" id="4-detail" class="detail-input">
                        </div>
                    </div>

                    <hr class="section-divider">

                    <div class="form-group">
                        <label class="section-label">๕. แหล่งที่มาของราคากลาง</label>
                        <div class="price-sources">
                            <div class="source-item">
                                <label for="source-5-1" class="source-label">๕.๑</label>
                                <input type="text" id="source-5-1" name="source-5-1" class="source-input"
                                    placeholder="ระบุแหล่งที่มาของราคา">
                            </div>
                            <div class="source-item">
                                <label for="source-5-2" class="source-label">๕.๒</label>
                                <input type="text" id="source-5-2" name="source-5-2" class="source-input"
                                    placeholder="ระบุแหล่งที่มาของราคา">
                            </div>
                            <div class="source-item">
                                <label for="source-5-3" class="source-label">๕.๓</label>
                                <input type="text" id="source-5-3" name="source-5-3" class="source-input"
                                    placeholder="ระบุแหล่งที่มาของราคา">
                            </div>
                            <div class="source-item">
                                <label for="source-5-4" class="source-label">๕.๔</label>
                                <input type="text" id="source-5-4" name="source-5-4" class="source-input"
                                    placeholder="ระบุแหล่งที่มาของราคา">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-footer">
                <button type="submit" class="manual-button">คู่มือการใช้งาน</button>
                <div>
                    <button type="button" id="previewBtn" class="preview-button">Generate PDF</button>
                    <button type="submit" class="generate-button">Generate Document</button>
                </div>
            </div>

        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="static/thai-utils.js"></script>
    <script>

        // Initialize Thai date pickers
        setupThaiDatePickers();

        // Improved form validation for task 3.2
        document.getElementById('procurementForm').addEventListener('submit', function (event) {
            // Get all required inputs
            const requiredInputs = document.querySelectorAll('#procurementForm [required]');
            let isValid = true;
            let errorMessage = '';

            // Check each required field
            requiredInputs.forEach(function (input) {
                if (!input.value.trim()) {
                    isValid = false;
                    const label = input.previousElementSibling?.textContent || input.closest('td')?.previousElementSibling?.textContent || 'required field';
                    errorMessage += `กรุณากรอก ${label.replace('*', '').trim()}\n`;
                    input.classList.add('error');
                } else {
                    input.classList.remove('error');
                }
            });

            // Prevent form submission if validation fails
            if (!isValid) {
                event.preventDefault();
                alert(errorMessage);
            }
        });

        // Real-time validation feedback
        document.querySelectorAll('#procurementForm [required]').forEach(function (input) {
            input.addEventListener('blur', function () {
                if (!this.value.trim()) {
                    this.classList.add('error');
                } else {
                    this.classList.remove('error');
                }
            });

            // Remove error class when user starts typing
            input.addEventListener('input', function () {
                if (this.value.trim()) {
                    this.classList.remove('error');
                }
            });
        });



        // Preview button functionality
        document.getElementById('previewBtn').addEventListener('click', function () {
            // Validate form before preview
            const requiredInputs = document.querySelectorAll('#procurementForm [required]');
            let isValid = true;

            requiredInputs.forEach(function (input) {
                if (!input.value.trim()) {
                    isValid = false;
                    input.classList.add('error');
                } else {
                    input.classList.remove('error');
                }
            });

            if (!isValid) {
                alert('กรุณากรอกข้อมูลที่จำเป็นให้ครบถ้วนก่อนดูตัวอย่าง');
                return;
            }

        });
    </script>
    <script src="static/supply-list.js"></script>
    <script src="static/jspdf.min.js"></script>
    <script src="static/jspdf.plugin.autotable.min.js"></script>
    <script src="static/element-of-pdf/signature-box.js"></script>
    <script src="static/element-of-pdf/first-line.js"></script>
    <script src="static/element-of-pdf/second-line.js"></script>
    <script src="static/element-of-pdf/third-line.js"></script>
    <script src="static/element-of-pdf/4th-To-19th-line.js"></script>
    <script src="static/element-of-pdf/rest-of-first-page.js"></script>
    <script src="static/element-of-pdf/page2.js"></script>
    <script src="static/element-of-pdf/third-page.js"></script>
    <script src="static/element-of-pdf/supply-table.js"></script>
    <script src="static/element-of-pdf/page4.js"></script>
    <script src="static/pdf-generator.js"></script>
    <script src="static/jspdf.plugin.autotable.min.js"></script>
    <script src="static/font/THSarabunNew-bold.js"></script>
    <script src="static/font/THSarabunNew-normal.js"></script>
</body>

</html>